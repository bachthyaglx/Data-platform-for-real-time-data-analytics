global:
  namespace: data-platform

zookeeper:
  enabled: true
  image: confluentinc/cp-zookeeper
  tag: "7.5.1"
  port: 2181

kafka:
  enabled: true
  image: confluentinc/cp-kafka
  tag: "7.5.1"
  replicas: 1
  port: 9092
  zookeeperConnect: "zookeeper:2181"
  autoCreateTopics: true
  bootstrapServers: "kafka:9092"

kafdrop:
  enabled: true
  image: obsidiandynamics/kafdrop
  tag: latest
  nodePort: 30090

kafkaProducer:
  enabled: true
  image: kafka-producer
  tag: latest
  pullPolicy: Never
  topic: orders
  bootstrapServers: "kafka:9092"

flink:
  enabled: true
  image:
    repository: flink-custom
    tag: latest
    pullPolicy: Never
  jobmanager:
    replicas: 1
    port: 8081
    nodePort: 31080
  taskmanager:
    replicas: 1
    taskSlots: 2
  sqlJobs:
    enabled: true
    multiStatementSql: |
      SET 'execution.runtime-mode' = 'streaming';
      SET 'execution.checkpointing.interval' = '10 s';

      USE CATALOG default_catalog;
      USE default_database;

      DROP TABLE IF EXISTS orders;

      CREATE TABLE orders (
        orderId STRING,
        customerId STRING,
        orderNumber INT,
        product STRING,
        backordered BOOLEAN,
        cost FLOAT,
        description STRING,
        create_ts BIGINT,
        creditCardNumber STRING,
        discountPercent INT
      ) WITH (
        'connector' = 'kafka',
        'topic' = 'orders',
        'properties.bootstrap.servers' = 'kafka:9092',
        'properties.group.id' = 'flink-orders-iceberg',
        'properties.auto.offset.reset' = 'earliest',
        'scan.startup.mode' = 'earliest-offset',
        'format' = 'json',
        'json.ignore-parse-errors' = 'true'
      );

      CREATE CATALOG iceberg_catalog WITH (
        'type' = 'iceberg',
        'catalog-type' = 'hive',
        'uri' = 'thrift://hive-metastore:9083',
        'warehouse' = 's3a://warehouse/iceberg-data',
        'fs.s3a.endpoint' = 'http://minio.data-platform.svc.cluster.local:9000',
        'fs.s3a.path.style.access' = 'true'
      );

      USE CATALOG iceberg_catalog;

      CREATE DATABASE IF NOT EXISTS default_database;
      USE default_database;

      CREATE TABLE IF NOT EXISTS orders_filtered (
        orderId STRING,
        customerId STRING,
        product STRING,
        cost FLOAT,
        create_ts BIGINT
      ) WITH (
        'write.format.default' = 'parquet'
      );

      INSERT INTO iceberg_catalog.default_database.orders_filtered
      SELECT
        orderId,
        customerId,
        product,
        cost,
        create_ts
      FROM default_catalog.default_database.orders
      WHERE cost > 160;

minio:
  enabled: true
  image: minio/minio
  tag: "RELEASE.2024-11-07T00-52-20Z"
  accessKey: admin
  secretKey: password
  defaultBuckets: "warehouse"
  nodePort: 31001

trino:
  enabled: true
  image:
    repository: trinodb/trino
    tag: "449"
    pullPolicy: IfNotPresent
  replicas: 1
  port: 8080
  nodePort: 31081

pinot:
  enabled: true
  image: apachepinot/pinot
  tag: "1.1.0"
  clusterName: "pinot-cluster"
  controller:
    port: 9000
    nodePort: 31090
  broker:
    port: 8099
  server:
    port: 8098
  deepStorage:
    scheme: "s3"
    bucket: "warehouse"
    region: "us-east-1"
    endpoint: "http://minio.data-platform.svc.cluster.local:9000"
    accessKey: "admin"
    secretKey: "password"
  data:
    schemaName: "orders"
    tableName: "orders"
    kafkaTopic: "orders"
    kafkaBroker: "kafka:9092"
